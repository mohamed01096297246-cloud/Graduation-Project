<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>EduLink Test Dashboard</title>
</head>

<body>

<h1>EduLink Testing Dashboard</h1>

<button onclick="logout()">Logout</button>
<hr>

<!-- LOGIN -->
<div id="loginSection">

<h2>Login</h2>

<input id="username" placeholder="Username"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>

<button onclick="login()">Login</button>

<p id="loginMsg"></p>

</div>


<!-- ADMIN PANEL -->
<div id="adminPanel" style="display:none">

<h2>Admin Panel</h2>

<h3>Create Teacher</h3>
<input id="tName" placeholder="Full Name">
<input id="tPhone" placeholder="Phone Number">
<input id="tNid" placeholder="National ID">
<input id="tEmail" placeholder="Email">
<button onclick="createTeacher()">Create Teacher</button>

<p id="teacherMsg"></p>

<hr>

<h3>Create Student</h3>
<input id="sName" placeholder="Student Name">
<input id="sPhone" placeholder="Student Phone">
<input id="sEmail" placeholder="Student Email">
<input id="grade" placeholder="Grade">
<input id="classroom" placeholder="Classroom">
<input id="pName" placeholder="Parent Name">
<input id="pPhone" placeholder="Parent Phone">
<input id="pNid" placeholder="Parent National ID">
<input id="pEmail" placeholder="Parent Email">
<button onclick="createStudent()">Create Student</button>

<p id="studentMsg"></p>

</div>


<!-- TEACHER PANEL -->
<div id="teacherPanel" style="display:none">

<h2>Teacher Panel</h2>

<input id="studentId" placeholder="Student ID">

<select id="status">
<option value="present">Present</option>
<option value="absent">Absent</option>
<option value="late">Late</option>
</select>

<button onclick="markAttendance()">Mark Attendance</button>

<p id="attendanceMsg"></p>

</div>


<!-- PARENT PANEL -->
<div id="parentPanel" style="display:none">

<h2>Parent Panel</h2>

<button onclick="loadAttendance()">Show Attendance</button>

<pre id="attendanceResult"></pre>

</div>


<script>

function showPanel(role){

document.getElementById("loginSection").style.display="none";

if(role === "admin")
document.getElementById("adminPanel").style.display="block";

if(role === "teacher")
document.getElementById("teacherPanel").style.display="block";

if(role === "parent")
document.getElementById("parentPanel").style.display="block";

}


// LOGIN
async function login(){

try{

const res = await fetch("http://localhost:5000/api/auth/login",{

method:"POST",
headers:{ "Content-Type":"application/json" },

body: JSON.stringify({
username: document.getElementById("username").value,
password: document.getElementById("password").value

})

});

const data = await res.json();

if(!res.ok) throw new Error(data.message || "Login failed");

localStorage.setItem("token", data.token);
localStorage.setItem("role", data.user.role);

showPanel(data.user.role);

}catch(err){
document.getElementById("loginMsg").innerText = err.message;
}

}


// CREATE TEACHER
async function createTeacher(){

const token = localStorage.getItem("token");

try{

const res = await fetch("http://localhost:5000/api/admin/create-teacher",{

method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer " + token
},

body: JSON.stringify({
fullName: tName.value,
phoneNumber: tPhone.value,
nationalId: tNid.value,
email: tEmail.value
})

});

const data = await res.json();

if(!res.ok) throw new Error(data.message);

teacherMsg.innerText = "Teacher created successfully";

}catch(err){
teacherMsg.innerText = err.message;
}

}


// CREATE STUDENT
async function createStudent(){

const token = localStorage.getItem("token");

try{

const res = await fetch("http://localhost:5000/api/admin/create-student",{

method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer " + token
},

body: JSON.stringify({
studentFullName: sName.value,
phoneNumber: sPhone.value,
email: sEmail.value,
grade: grade.value,
classroom: classroom.value,
parentName: pName.value,
parentPhoneNumber: pPhone.value,
parentNationalId: pNid.value,
parentEmail: pEmail.value
})

});

const data = await res.json();

if(!res.ok) throw new Error(data.message);

studentMsg.innerText = "Student created successfully";

}catch(err){
studentMsg.innerText = err.message;
}

}


// MARK ATTENDANCE
async function markAttendance(){

const token = localStorage.getItem("token");

try{

const res = await fetch("http://localhost:5000/api/attendance",{

method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer " + token
},

body: JSON.stringify({
studentId: studentId.value,
status: status.value
})

});

const data = await res.json();

if(!res.ok) throw new Error(data.message);

attendanceMsg.innerText = "Attendance Saved";

}catch(err){
attendanceMsg.innerText = err.message;
}

}


// LOAD PARENT ATTENDANCE
async function loadAttendance(){

const token = localStorage.getItem("token");

const res = await fetch("http://localhost:5000/api/attendance/parent",{

headers:{
"Authorization":"Bearer " + token
}

});

const data = await res.json();

attendanceResult.textContent = JSON.stringify(data,null,2);

}

function logout(){
  localStorage.clear();
  location.reload();
}


</script>

</body>
</html>
